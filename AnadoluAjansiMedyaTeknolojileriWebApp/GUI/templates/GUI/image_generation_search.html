{% extends 'base.html' %}

{% block extra_css %}
<style>
    .custom-card-body {
        color: white;
    }

    /* Adjust the size and spacing as needed */
    @media (min-width: 768px) {
        .col-md-4 {
            flex: 0 0 auto;
            width: 30%;
        }
    }
    .shadowed-text {
        text-shadow: 2px 2px 4px #000000; /* Black shadow */
    }
    
    .g-2 {
        gap: .5rem;
    }
    .custom-card {
        position: relative;
        width: 100%;
        overflow: hidden;
    }
    .custom-card-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        opacity: 0.95; /* 70% Opaque */
    }
    .aspect-ratio-7-4 {
        position: relative;
        width: 100%;
    }
    
    .aspect-ratio-7-4::before {
        content: '';
        display: block;
        padding-top: calc(100% * (4 / 7)); /* Corrected Aspect Ratio Calculation */
    }
    
    
    .shadowed-text {
        text-shadow: 2px 2px 4px #000000; /* Black shadow */
    }
    
</style>
{% endblock %}

{% block title %}Image Generation Search{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-6 offset-md-3">
        <h2>Find Similar Image Generations</h2>
        <form method="post">
            {% csrf_token %}
            <div class="mb-3">
                {{ form.image_generation.label_tag }}
                {{ form.image_generation }}
            </div>
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>
</div>
{% if similar_objects_with_scores %}
<div class="row mt-4">
    <div class="col-md-12">
        <h3>Similar Image Generations</h3>
        <div class="row">
            {% for object, score in similar_objects_with_scores %}
            <div class="col-md-6 mb-4">
                <div class="card ratio ratio-7x4 h-100 custom-card aspect-ratio-7-4" style="background-image: url('{{ object.random_image_url }}'); background-size: cover;">
                    <div class="card-body d-flex flex-column justify-content-end shadowed-text" style="color: white; border: 2px solid black;">
                        <h5 class="card-title">{{ object.news_context.headline }}</h5>
                        <!-- Display Similarity Score -->
                        <p class="card-text"><strong>Similarity Score:</strong> {{ score|floatformat:2 }}</p>
                        <p class="card-text"><strong>Category:</strong> {{ object.news_context.category }}</p>
                        <div class="row">
                            <div class="col">
                                <p class="card-text"><strong>Emotion Tone:</strong> {{ object.news_context.emotionTone }}</p>
                            </div>
                            <div class="col">
                                <p class="card-text"><strong>Emotional Intensity:</strong> {{ object.news_context.emotionalIntensity }}</p>
                            </div>
                        </div>
                        <p class="card-text"><strong>Geographical Context:</strong> {{ object.news_context.geographicalContext }}</p>
                        <!-- Full Details Button -->
                        <a href="{% url 'imagegeneration_detail' object.id %}" class="btn btn-secondary" style="background-color: rgba(108, 117, 125, 0.1);">Full Details</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}


{% endblock %}
